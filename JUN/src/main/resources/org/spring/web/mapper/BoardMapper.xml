<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.spring.web.mapper.BoardMapper">

	<insert id="create"> insert into tbl_board (title, content , writer)
		values (#{title}, #{content} , #{writer});
	</insert>

	<select id="listAll" resultType="org.spring.web.vo.BoardVO">
		select* from(
		select @rownum:=@rownum+1 as rownum, b.*
		from (select
		@rownum:=0) as tmp, tbl_board as b
		order by bno desc
		) as boardList 
	<![CDATA[
	where rownum > (#{cri.pageNum}-1)*#{cri.amount} and rownum <= #{cri.pageNum}*#{cri.amount}
	]]>
	</select>

	<select id="read" resultType="org.spring.web.vo.BoardVO">
		<![CDATA[
		select *,
		ifnull((select bno from tbl_board where bno > #{bno} limit 1),0) as next,
		ifnull((select bno from tbl_board where bno < #{bno} order by bno desc limit 1 ),0) as prev 
		from tbl_board where bno = #{bno}
		]]>
	</select>

	<update id="modify">
		UPDATE tbl_board SET title=#{title}
		,content=#{content} WHERE bno=#{bno}
	</update>
	<delete id="delete">
		DELETE FROM tbl_board WHERE bno=#{bno}
	</delete>
	<select id="getTotalCount" resultType="int">
		SELECT COUNT(*) FROM
		tbl_board
	</select>
	<update id="plusViewCnt">
		update tbl_board set viewcnt= viewcnt+1 where
		bno=#{bno}
	</update>
	<update id="plusLikeCnt" useGeneratedKeys="true" keyProperty="likecnt" parameterType="Integer">
		update tbl_board set likecnt= likecnt+1 where bno=#{bno}
	</update>
	<select id="getLikeCnt" resultType="Integer">
		select likecnt from tbl_board where bno = #{bno}
	</select>
</mapper>